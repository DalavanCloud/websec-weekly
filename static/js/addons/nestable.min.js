/*! UIkit 2.10.0 | http://www.getuikit.com | (c) 2014 YOOtheme | MIT License */

!function(a){var b;jQuery&&jQuery.UIkit&&(b=a(jQuery,jQuery.UIkit)),"function"==typeof define&&define.amd&&define("uikit-nestable",["uikit"],function(){return b||a(jQuery,jQuery.UIkit)})}(function(a,b){var c,d="ontouchstart"in window,e=a("html"),f=[],g=b.$win,h=function(){var a=document.createElement("div"),b=document.documentElement;if(!("pointerEvents"in a.style))return!1;a.style.pointerEvents="auto",a.style.pointerEvents="x",b.appendChild(a);var c=window.getComputedStyle&&"auto"===window.getComputedStyle(a,"").pointerEvents;return b.removeChild(a),!!c}(),i=d?"touchstart":"mousedown",j=d?"touchmove":"mousemove",k=d?"touchend":"mouseup",l=d?"touchcancel":"mouseup";return b.component("nestable",{defaults:{prefix:"uk",listNodeName:"ul",itemNodeName:"li",listBaseClass:"{prefix}-nestable",listClass:"{prefix}-nestable-list",listitemClass:"{prefix}-nestable-list-item",itemClass:"{prefix}-nestable-item",dragClass:"{prefix}-nestable-list-dragged",movingClass:"{prefix}-nestable-moving",handleClass:"{prefix}-nestable-handle",collapsedClass:"{prefix}-collapsed",placeClass:"{prefix}-nestable-placeholder",noDragClass:"{prefix}-nestable-nodrag",emptyClass:"{prefix}-nestable-empty",group:0,maxDepth:10,threshold:20},init:function(){var b=this;Object.keys(this.options).forEach(function(a){-1!=String(b.options[a]).indexOf("{prefix}")&&(b.options[a]=b.options[a].replace("{prefix}",b.options.prefix))}),this.tplempty='<div class="'+this.options.emptyClass+'"/>',this.find(">"+this.options.itemNodeName).addClass(this.options.listitemClass).end().find("ul:not(.ignore-list)").addClass(this.options.listClass).find(">li").addClass(this.options.listitemClass),this.element.children(this.options.itemNodeName).length||this.element.append(this.tplempty),this.element.data("nestable-id","ID"+(new Date).getTime()+"RAND"+Math.ceil(1e5*Math.random())),this.reset(),this.element.data("nestable-group",this.options.group),this.placeEl=a('<div class="'+this.options.placeClass+'"/>'),this.find(this.options.itemNodeName).each(function(){b.setParent(a(this))}),this.on("click","[data-nestable-action]",function(c){if(!b.dragEl&&(d||0===c.button)){c.preventDefault();var e=a(c.currentTarget),f=e.data("nestableAction"),g=e.closest(b.options.itemNodeName);"collapse"===f&&b.collapseItem(g),"expand"===f&&b.expandItem(g),"toggle"===f&&b.toggleItem(g)}});var e=function(c){var e=a(c.target);if(!e.hasClass(b.options.handleClass)){if(e.closest("."+b.options.noDragClass).length)return;e=e.closest("."+b.options.handleClass)}!e.length||b.dragEl||!d&&0!==c.button||d&&1!==c.touches.length||(c.preventDefault(),b.dragStart(d?c.touches[0]:c),b.trigger("uk.nestable.start",[b]))},f=function(a){b.dragEl&&(a.preventDefault(),b.dragMove(d?a.touches[0]:a),b.trigger("uk.nestable.move",[b]))},h=function(a){b.dragEl&&(a.preventDefault(),b.dragStop(d?a.touches[0]:a),b.trigger("uk.nestable.stop",[b])),c=!1};d?(this.element[0].addEventListener(i,e,!1),window.addEventListener(j,f,!1),window.addEventListener(k,h,!1),window.addEventListener(l,h,!1)):(this.on(i,e),g.on(j,f),g.on(k,h))},serialize:function(){var b,c=0,d=this;return step=function(b,c){var e=[],f=b.children(d.options.itemNodeName);return f.each(function(){var b=a(this),f=a.extend({},b.data()),g=b.children(d.options.listNodeName);g.length&&(f.children=step(g,c+1)),e.push(f)}),e},b=step(d.element,c)},list:function(b){var c=[],d=this,e=0,b=a.extend({},d.options,b),f=function(d,e,g){var h=d.children(b.itemNodeName);h.each(function(d){var h=a(this),i=a.extend({parent_id:g?g:null,depth:e,order:d},h.data()),j=h.children(b.listNodeName);c.push(i),j.length&&f(j,e+1,h.data(b.idProperty||"id"))})};return f(d.element,e),c},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragDepth=0,this.hasNewRoot=!1,this.pointEl=null;for(var a=0;a<f.length;a++)f[a].children().length||f[a].append(this.tplempty);f=[]},toggleItem:function(a){this[a.hasClass(this.options.collapsedClass)?"expandItem":"collapseItem"](a)},expandItem:function(a){a.removeClass(this.options.collapsedClass)},collapseItem:function(a){var b=a.children(this.options.listNodeName);b.length&&a.addClass(this.options.collapsedClass)},expandAll:function(){var b=this;this.find(b.options.itemNodeName).each(function(){b.expandItem(a(this))})},collapseAll:function(){var b=this;this.find(b.options.itemNodeName).each(function(){b.collapseItem(a(this))})},setParent:function(a){a.children(this.options.listNodeName).length&&a.addClass("uk-parent")},unsetParent:function(a){a.removeClass("uk-parent "+this.options.collapsedClass),a.children(this.options.listNodeName).remove()},dragStart:function(b){var d=this.mouse,f=a(b.target),g=f.closest(this.options.itemNodeName),h=g.offset();this.placeEl.css("height",g.height()),d.offsetX=b.pageX-h.left,d.offsetY=b.pageY-h.top,d.startX=d.lastX=h.left,d.startY=d.lastY=h.top,this.dragRootEl=this.element,this.dragEl=a(document.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass),this.dragEl.css("width",g.width()),c=this.dragEl,this.tmpDragOnSiblings=[g[0].previousSibling,g[0].nextSibling],g.after(this.placeEl),g[0].parentNode.removeChild(g[0]),g.appendTo(this.dragEl),a(document.body).append(this.dragEl),this.dragEl.css({left:h.left,top:h.top});var i,j,k=this.dragEl.find(this.options.itemNodeName);for(i=0;i<k.length;i++)j=a(k[i]).parents(this.options.listNodeName).length,j>this.dragDepth&&(this.dragDepth=j);e.addClass(this.options.movingClass)},dragStop:function(){var a=this.dragEl.children(this.options.itemNodeName).first();a[0].parentNode.removeChild(a[0]),this.placeEl.replaceWith(a),this.dragEl.remove(),(this.tmpDragOnSiblings[0]!=a[0].previousSibling||this.tmpDragOnSiblings[0]!=a[0].previousSibling)&&(this.element.trigger("uk.nestable.change",[a,this.hasNewRoot?"added":"moved"]),this.hasNewRoot&&this.dragRootEl.trigger("uk.nestable.change",[a,"removed"])),this.reset(),e.removeClass(this.options.movingClass)},dragMove:function(b){var c,d,e,g,i,j=this.options,k=this.mouse;this.dragEl.css({left:b.pageX-k.offsetX,top:b.pageY-k.offsetY}),k.lastX=k.nowX,k.lastY=k.nowY,k.nowX=b.pageX,k.nowY=b.pageY,k.distX=k.nowX-k.lastX,k.distY=k.nowY-k.lastY,k.lastDirX=k.dirX,k.lastDirY=k.dirY,k.dirX=0===k.distX?0:k.distX>0?1:-1,k.dirY=0===k.distY?0:k.distY>0?1:-1;var l=Math.abs(k.distX)>Math.abs(k.distY)?1:0;if(!k.moving)return k.dirAx=l,void(k.moving=!0);k.dirAx!==l?(k.distAxX=0,k.distAxY=0):(k.distAxX+=Math.abs(k.distX),0!==k.dirX&&k.dirX!==k.lastDirX&&(k.distAxX=0),k.distAxY+=Math.abs(k.distY),0!==k.dirY&&k.dirY!==k.lastDirY&&(k.distAxY=0)),k.dirAx=l,k.dirAx&&k.distAxX>=j.threshold&&(k.distAxX=0,e=this.placeEl.prev(j.itemNodeName),k.distX>0&&e.length&&!e.hasClass(j.collapsedClass)&&(c=e.find(j.listNodeName).last(),i=this.placeEl.parents(j.listNodeName).length,i+this.dragDepth<=j.maxDepth&&(c.length?(c=e.children(j.listNodeName).last(),c.append(this.placeEl)):(c=a("<"+j.listNodeName+"/>").addClass(j.listClass),c.append(this.placeEl),e.append(c),this.setParent(e)))),k.distX<0&&(g=this.placeEl.next(j.itemNodeName),g.length||(d=this.placeEl.parent(),this.placeEl.closest(j.itemNodeName).after(this.placeEl),d.children().length||this.unsetParent(d.parent()))));var m=!1;if(h||(this.dragEl[0].style.visibility="hidden"),this.pointEl=a(document.elementFromPoint(b.pageX-document.body.scrollLeft,b.pageY-(window.pageYOffset||document.documentElement.scrollTop))),h||(this.dragEl[0].style.visibility="visible"),this.pointEl.hasClass(j.handleClass))this.pointEl=this.pointEl.closest(j.itemNodeName);else{var n=this.pointEl.closest("."+j.itemClass);n.length&&(this.pointEl=n.closest(j.itemNodeName))}if(this.pointEl.hasClass(j.emptyClass))m=!0;else if(this.pointEl.data("nestable")&&!this.pointEl.children().length)m=!0,this.pointEl=a(this.tplempty).appendTo(this.pointEl);else if(!this.pointEl.length||!this.pointEl.hasClass(j.listitemClass))return;var o=this.element,p=this.pointEl.closest("."+this.options.listBaseClass),q=o[0]!==this.pointEl.closest("."+this.options.listBaseClass)[0],r=p;if(!k.dirAx||q||m){if(q&&j.group!==r.data("nestable-group"))return;if(f.push(o),i=this.dragDepth-1+this.pointEl.parents(j.listNodeName).length,i>j.maxDepth)return;var s=b.pageY<this.pointEl.offset().top+this.pointEl.height()/2;d=this.placeEl.parent(),m?this.pointEl.replaceWith(this.placeEl):s?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),d.children().length||d.data("nestable")||this.unsetParent(d.parent()),this.dragRootEl.find(j.itemNodeName).length||this.dragRootEl.children().length||this.dragRootEl.append(this.tplempty),q&&(this.dragRootEl=p,this.hasNewRoot=this.element[0]!==this.dragRootEl[0])}}}),a("html").on("mousemove touchmove",function(){if(c){var a=c.offset().top;a<b.$win.scrollTop()?b.$win.scrollTop(b.$win.scrollTop()-Math.ceil(c.height()/2)):a+c.height()>window.innerHeight+b.$win.scrollTop()&&b.$win.scrollTop(b.$win.scrollTop()+Math.ceil(c.height()/2))}}),b.ready(function(c){a("[data-uk-nestable]",c).each(function(){var c=a(this);if(!c.data("nestable")){b.nestable(c,b.Utils.options(c.attr("data-uk-nestable")))}})}),b.nestable});